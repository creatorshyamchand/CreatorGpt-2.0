<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CreatorGpt - AI Question Solver</title>
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs (Compat for easiest implementation) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        glass: "rgba(15, 23, 42, 0.7)",
                        glassBorder: "rgba(255, 255, 255, 0.08)",
                        neonTeal: "#14b8a6",
                        neonCyan: "#06b6d4",
                        neonPink: "#f472b6",
                        darkBg: "#020617"
                    },
                    animation: {
                        'pulse-glow': 'pulse-glow 3s ease-in-out infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'scanline': 'scanline 2s linear infinite',
                    },
                    keyframes: {
                        'pulse-glow': {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(20, 184, 166, 0.2)' },
                            '50%': { boxShadow: '0 0 40px rgba(6, 182, 212, 0.4)' },
                        },
                        'float': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #020617;
            color: #e2e8f0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        /* Loader */
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: #14b8a6;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Hide Scrollbar for App Container but allow scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Transition Classes */
        .fade-enter { opacity: 0; transform: translateY(10px); }
        .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 300ms, transform 300ms; }
        .fade-exit { opacity: 1; transform: translateY(0); }
        .fade-exit-active { opacity: 0; transform: translateY(-10px); transition: opacity 300ms, transform 300ms; }
    </style>
    
    <!-- Import Map for GenAI -->
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.run/@google/genai",
    "firebase/": "https://aistudiocdn.com/firebase@^12.6.0/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react/": "https://aistudiocdn.com/react@^19.2.1/"
  }
}
</script>
</head>
<body class="antialiased min-h-screen relative selection:bg-teal-500/30">

    <!-- Background Particles Canvas -->
    <canvas id="starfield" class="fixed inset-0 z-0 pointer-events-none"></canvas>

    <!-- ================= SPLASH SCREEN ================= -->
    <div id="splash-screen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-slate-950 transition-opacity duration-500">
        <div class="relative w-32 h-32 mb-8">
            <div class="absolute inset-0 rounded-full border-4 border-teal-500/30 animate-ping"></div>
            <div class="relative z-10 w-full h-full rounded-full border-2 border-teal-400 p-1 bg-black shadow-[0_0_50px_rgba(20,184,166,0.5)] overflow-hidden">
                <img src="https://i.ibb.co/9mRt8cBy/IMG-20250616-054954-581-removebg-preview.png" alt="Logo" class="w-full h-full object-cover">
            </div>
        </div>
        <h1 class="text-3xl md:text-4xl font-bold font-mono tracking-tighter">
            <span class="text-teal-400">Creator</span><span class="text-white">Gpt</span>
        </h1>
        <div id="splash-text" class="mt-4 text-cyan-400/80 font-mono text-xs uppercase tracking-widest h-4">INITIALIZING SECURITY PROTOCOLS...</div>
    </div>

    <!-- ================= AUTH SCREEN ================= -->
    <div id="auth-screen" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-md rounded-3xl p-8 shadow-2xl animate-float">
            <div class="text-center mb-8">
                <div class="inline-block w-20 h-20 rounded-full border-2 border-teal-500/50 p-1 mb-4">
                    <img src="https://i.ibb.co/9mRt8cBy/IMG-20250616-054954-581-removebg-preview.png" alt="Logo" class="w-full h-full rounded-full object-cover">
                </div>
                <h2 id="auth-title" class="text-2xl font-bold text-white">Welcome Back</h2>
                <p class="text-slate-400 text-sm mt-1">Secure Login Required</p>
            </div>

            <form id="auth-form" class="space-y-4">
                <div class="relative">
                    <i class="fa-solid fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
                    <input type="email" id="auth-email" placeholder="Email Address" required
                        class="w-full bg-slate-900/50 border border-slate-700 rounded-xl py-4 pl-12 pr-4 text-white focus:outline-none focus:border-teal-500 transition-colors">
                </div>
                <div class="relative">
                    <i class="fa-solid fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
                    <input type="password" id="auth-password" placeholder="Password" required
                        class="w-full bg-slate-900/50 border border-slate-700 rounded-xl py-4 pl-12 pr-4 text-white focus:outline-none focus:border-teal-500 transition-colors">
                </div>
                
                <div id="auth-error" class="hidden text-center text-red-400 text-xs bg-red-500/10 p-2 rounded-lg border border-red-500/20"></div>

                <button type="submit" id="auth-submit-btn" class="w-full py-4 bg-gradient-to-r from-teal-500 to-cyan-500 rounded-xl text-white font-bold shadow-lg shadow-teal-500/20 hover:scale-[1.02] active:scale-95 transition-all">
                    Access System
                </button>
            </form>

            <div class="mt-6 text-center">
                <p class="text-slate-400 text-sm">
                    <span id="auth-switch-text">Don't have an account?</span>
                    <button id="auth-switch-btn" class="ml-2 text-teal-400 font-bold hover:underline">Register</button>
                </p>
            </div>
        </div>
    </div>

    <!-- ================= MAIN APP ================= -->
    <div id="app-screen" class="hidden relative z-10 w-full max-w-2xl mx-auto pb-24 pt-6 px-4 min-h-screen flex flex-col">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full border border-teal-500/50 p-0.5">
                    <img src="https://i.ibb.co/9mRt8cBy/IMG-20250616-054954-581-removebg-preview.png" class="w-full h-full rounded-full object-cover">
                </div>
                <div>
                    <h1 class="font-bold text-lg leading-tight">CreatorGpt</h1>
                    <div class="flex items-center gap-1.5">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-[10px] text-green-400 font-mono tracking-wider">ONLINE</span>
                    </div>
                </div>
            </div>
            <div id="user-avatar" class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-xs text-slate-400">
                <i class="fa-solid fa-user"></i>
            </div>
        </header>

        <!-- Dynamic Content Container -->
        <main id="main-content" class="flex-1 relative">
            
            <!-- HOME TAB (SOLVER) -->
            <div id="tab-home" class="fade-enter-active">
                <!-- Ad/Notice -->
                <div id="notice-board" class="glass-panel p-3 rounded-xl mb-6 text-center hidden">
                    <p id="notice-text" class="text-yellow-200 text-sm font-medium animate-pulse"></p>
                </div>

                <!-- Subjects -->
                <div class="grid grid-cols-3 gap-3 mb-6">
                    <button class="subject-btn active group relative overflow-hidden glass-panel p-3 rounded-xl border-teal-500/50" data-id="math">
                        <div class="absolute inset-0 bg-teal-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="text-2xl mb-1">üî¢</div>
                        <div class="text-xs font-medium text-slate-300">Math</div>
                    </button>
                    <button class="subject-btn group glass-panel p-3 rounded-xl hover:border-teal-500/50 transition-all" data-id="physics">
                        <div class="text-2xl mb-1">‚öõÔ∏è</div>
                        <div class="text-xs font-medium text-slate-300">Physics</div>
                    </button>
                    <button class="subject-btn group glass-panel p-3 rounded-xl hover:border-teal-500/50 transition-all" data-id="history">
                        <div class="text-2xl mb-1">üìú</div>
                        <div class="text-xs font-medium text-slate-300">History</div>
                    </button>
                    <button class="subject-btn group glass-panel p-3 rounded-xl hover:border-teal-500/50 transition-all" data-id="geography">
                        <div class="text-2xl mb-1">üåç</div>
                        <div class="text-xs font-medium text-slate-300">Geography</div>
                    </button>
                    <button class="subject-btn group glass-panel p-3 rounded-xl hover:border-teal-500/50 transition-all" data-id="english">
                        <div class="text-2xl mb-1">‚öúÔ∏è</div>
                        <div class="text-xs font-medium text-slate-300">English</div>
                    </button>
                    <button class="subject-btn group glass-panel p-3 rounded-xl hover:border-teal-500/50 transition-all" data-id="bengali">
                        <div class="text-2xl mb-1">üåº</div>
                        <div class="text-xs font-medium text-slate-300">Bengali</div>
                    </button>
                </div>

                <!-- Input Area -->
                <div class="glass-panel rounded-2xl p-4 mb-6">
                    <textarea id="question-input" class="w-full bg-transparent border-none focus:ring-0 text-white placeholder-slate-500 resize-none h-24 mb-3" placeholder="Type your Math question here..."></textarea>
                    
                    <!-- Image Preview -->
                    <div id="image-preview-container" class="hidden relative w-full h-20 bg-slate-900/50 rounded-lg mb-3 flex items-center justify-center overflow-hidden border border-teal-500/30">
                        <img id="image-preview" class="h-full object-contain">
                        <button id="remove-image" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600">√ó</button>
                    </div>

                    <div class="flex items-center justify-between pt-3 border-t border-slate-700/50">
                        <div class="flex gap-2">
                            <button id="upload-btn" class="w-10 h-10 rounded-full bg-slate-800 hover:bg-slate-700 text-teal-400 flex items-center justify-center transition-colors">
                                <i class="fa-solid fa-camera"></i>
                            </button>
                            <input type="file" id="file-input" accept="image/*" class="hidden">
                            
                            <select id="detail-level" class="bg-slate-800 text-xs text-slate-300 rounded-lg px-3 outline-none border border-slate-700">
                                <option value="medium">Medium</option>
                                <option value="short">Short</option>
                                <option value="detailed">Detailed</option>
                            </select>
                        </div>
                        <button id="solve-btn" class="bg-teal-500 hover:bg-teal-400 text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg shadow-teal-500/20 transition-all active:scale-95">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <!-- Result Area -->
                <div id="result-container" class="hidden glass-panel rounded-2xl p-6 border-l-4 border-l-teal-500 animate-float">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-2 text-teal-400 font-bold">
                            <i class="fa-solid fa-microchip"></i>
                            <span>AI Solution</span>
                        </div>
                        <div class="flex gap-3 text-slate-400">
                            <button id="speak-btn" class="hover:text-white"><i class="fa-solid fa-volume-high"></i></button>
                            <button id="copy-btn" class="hover:text-white"><i class="fa-regular fa-copy"></i></button>
                        </div>
                    </div>
                    <div id="result-content" class="text-slate-200 text-sm leading-relaxed font-light whitespace-pre-wrap"></div>
                </div>
            </div>

            <!-- ABOUT TAB -->
            <div id="tab-about" class="hidden">
                <div class="glass-panel rounded-3xl p-8 mb-8 text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-teal-500 to-purple-500"></div>
                    <div class="w-32 h-32 mx-auto rounded-full p-1 bg-gradient-to-tr from-teal-400 to-purple-500 mb-4 shadow-[0_0_30px_rgba(20,184,166,0.3)]">
                        <img src="https://i.ibb.co/TzBnXSF/1752411802894.jpg" class="w-full h-full rounded-full object-cover border-4 border-slate-900">
                    </div>
                    <h2 class="text-2xl font-bold text-white">creator_Shyamchand</h2>
                    <p class="text-teal-400 text-xs font-bold uppercase tracking-wider mb-4">Lead Developer</p>
                    <p class="text-slate-400 text-sm mb-6">Building the future with AI and Web Technologies. Explore, ask, and discover!</p>
                    
                    <div class="flex justify-center gap-4 mb-6">
                        <a href="https://youtube.com/@CREATORSHYAMCHAND" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 text-red-500 flex items-center justify-center hover:scale-110 transition-transform"><i class="fa-brands fa-youtube"></i></a>
                        <a href="https://www.instagram.com/creator_shyamchand/" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 text-pink-500 flex items-center justify-center hover:scale-110 transition-transform"><i class="fa-brands fa-instagram"></i></a>
                    </div>
                    
                    <button class="like-btn group flex items-center justify-center gap-2 mx-auto px-6 py-2 rounded-full border border-slate-600 hover:border-pink-500 hover:bg-pink-500/10 transition-all" data-person="shyamchand">
                        <i class="fa-regular fa-heart text-pink-500 group-hover:scale-110 transition-transform"></i>
                        <span class="like-count font-mono text-sm">Loading...</span>
                    </button>
                </div>

                <h3 class="text-xl font-bold mb-4 pl-2 border-l-4 border-teal-500">Core Team</h3>
                <div class="space-y-4" id="team-list">
                    <!-- Team members injected by JS -->
                </div>
            </div>

            <!-- CONTACT TAB -->
            <div id="tab-contact" class="hidden">
                <div class="glass-panel rounded-3xl p-8">
                    <h2 class="text-2xl font-bold mb-2">Get in Touch</h2>
                    <p class="text-slate-400 text-sm mb-6">Have questions or feedback? Send us a secure transmission.</p>
                    
                    <form id="contact-form" class="space-y-4">
                        <input type="text" id="contact-name" placeholder="Name" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white focus:border-teal-500 outline-none">
                        <input type="email" id="contact-email" placeholder="Email" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white focus:border-teal-500 outline-none">
                        <textarea id="contact-message" rows="4" placeholder="Message" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white focus:border-teal-500 outline-none resize-none"></textarea>
                        <button type="submit" class="w-full py-4 bg-teal-500 hover:bg-teal-400 text-white font-bold rounded-xl transition-colors">Send Transmission</button>
                    </form>
                </div>
            </div>

        </main>
    </div>

    <!-- ================= FOOTER NAV ================= -->
    <nav id="footer-nav" class="hidden fixed bottom-0 left-0 right-0 bg-slate-900/90 backdrop-blur-xl border-t border-slate-800 z-40 pb-safe">
        <div class="flex justify-around items-center max-w-2xl mx-auto h-[70px]">
            <button class="nav-btn active flex flex-col items-center justify-center flex-1 h-full text-slate-500 hover:text-white transition-colors" data-target="home">
                <i class="fa-solid fa-house text-xl mb-1"></i>
                <span class="text-[10px] font-medium uppercase tracking-wide">Home</span>
            </button>
            <button class="nav-btn flex flex-col items-center justify-center flex-1 h-full text-slate-500 hover:text-white transition-colors" data-target="about">
                <i class="fa-solid fa-circle-info text-xl mb-1"></i>
                <span class="text-[10px] font-medium uppercase tracking-wide">About</span>
            </button>
            <button class="nav-btn flex flex-col items-center justify-center flex-1 h-full text-slate-500 hover:text-white transition-colors" data-target="contact">
                <i class="fa-solid fa-envelope text-xl mb-1"></i>
                <span class="text-[10px] font-medium uppercase tracking-wide">Contact</span>
            </button>
            <button id="logout-btn" class="flex flex-col items-center justify-center flex-1 h-full text-red-500/70 hover:text-red-500 transition-colors">
                <i class="fa-solid fa-power-off text-xl mb-1"></i>
                <span class="text-[10px] font-medium uppercase tracking-wide">Logout</span>
            </button>
        </div>
    </nav>

    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- 1. CONFIGURATION & STATE ---
        const firebaseConfig = {
            apiKey: "AIzaSyB2aUW-D5lwBFAr118CnDCjWbbc7Za1SKM",
            authDomain: "creatorgpt-solver.firebaseapp.com",
            projectId: "creatorgpt-solver",
            storageBucket: "creatorgpt-solver.firebasestorage.app",
            messagingSenderId: "982978006189",
            appId: "1:982978006189:web:8622899265cf3f4d8f8a24",
            measurementId: "G-MCZ0SHST3S"
        };

        const state = {
            user: null,
            view: 'home',
            subject: 'math',
            imageData: null
        };

        const subjects = {
            math: { label: 'Math', context: 'As a math expert, provide step-by-step solutions.' },
            physics: { label: 'Physics', context: 'Explain the principles clearly.' },
            history: { label: 'History', context: 'Provide concise, factual historical context.' },
            geography: { label: 'Geography', context: 'Focus on location and physical details.' },
            english: { label: 'English', context: 'Assist with grammar and literature.' },
            bengali: { label: 'Bengali', context: 'Provide the answer entirely in Bengali.' }
        };

        const teamData = [
            { id: 'rajat', name: 'Smile__Killar__Rajat', img: 'https://i.ibb.co/qMdkW2p8/smile-killar-rajat-20250725-0001.jpg' },
            { id: 'supriyo', name: "IT'Z SUPRIYO", img: 'https://i.ibb.co/KxJBvpsN/5fb9f5a1bbfe427571a448b63a0859e8.jpg' },
            { id: 'suresh', name: "IT'S SURESH", img: 'https://i.ibb.co/PG0SYRy5/itz-suresh-0m-20250727-0001.jpg' }
        ];

        // --- 2. INITIALIZATION ---
        
        // Initialize Firebase
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Initialize GenAI
        // NOTE: In a strictly client-side view without build steps, process.env is undefined.
        // We handle this gracefully. If you host this, ensure the build system replaces this or use a proxy.
        const API_KEY = process.env.API_KEY || "YOUR_API_KEY_HERE"; 
        const ai = new GoogleGenAI({ apiKey: API_KEY });

        // --- 3. DOM ELEMENTS ---
        const els = {
            splash: document.getElementById('splash-screen'),
            auth: document.getElementById('auth-screen'),
            app: document.getElementById('app-screen'),
            nav: document.getElementById('footer-nav'),
            tabs: {
                home: document.getElementById('tab-home'),
                about: document.getElementById('tab-about'),
                contact: document.getElementById('tab-contact')
            },
            inputs: {
                question: document.getElementById('question-input'),
                file: document.getElementById('file-input'),
                detail: document.getElementById('detail-level')
            }
        };

        // --- 4. ANIMATION LOGIC (PARTICLES) ---
        function initParticles() {
            const canvas = document.getElementById('starfield');
            const ctx = canvas.getContext('2d');
            let particles = [];

            const resize = () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            };
            window.addEventListener('resize', resize);
            resize();

            class Particle {
                constructor() {
                    this.reset();
                }
                reset() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.size = Math.random() * 2;
                    this.speed = Math.random() * 0.5 + 0.1;
                    this.opacity = Math.random() * 0.5 + 0.1;
                }
                update() {
                    this.y -= this.speed;
                    if (this.y < 0) this.reset();
                }
                draw() {
                    ctx.fillStyle = `rgba(20, 184, 166, ${this.opacity})`;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            for(let i=0; i<100; i++) particles.push(new Particle());

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => { p.update(); p.draw(); });
                requestAnimationFrame(animate);
            }
            animate();
        }

        // --- 5. UI CONTROLLERS ---
        
        function switchView(viewName) {
            // Hide all tabs
            Object.values(els.tabs).forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active', 'text-teal-400'));
            
            // Show specific tab
            els.tabs[viewName].classList.remove('hidden');
            
            // Update Nav
            const btn = document.querySelector(`.nav-btn[data-target="${viewName}"]`);
            if(btn) {
                btn.classList.add('active', 'text-teal-400');
                btn.classList.remove('text-slate-500');
            }
            
            // Scroll top
            window.scrollTo(0,0);
        }

        function showSplashTextEffect() {
            const texts = ["CONNECTING...", "VERIFYING BIOMETRICS...", "LOADING NEURAL NET...", "ACCESS GRANTED"];
            const el = document.getElementById('splash-text');
            let i = 0;
            const interval = setInterval(() => {
                if(i >= texts.length) { clearInterval(interval); return; }
                el.innerText = texts[i];
                i++;
            }, 800);
        }

        // --- 6. AUTHENTICATION LOGIC ---
        
        let isLoginMode = true;

        auth.onAuthStateChanged(user => {
            state.user = user;
            setTimeout(() => { // Small delay for splash effect
                els.splash.classList.add('opacity-0', 'pointer-events-none');
                
                if (user) {
                    els.auth.classList.add('hidden');
                    els.app.classList.remove('hidden');
                    els.nav.classList.remove('hidden');
                    document.getElementById('user-avatar').innerHTML = user.email ? user.email[0].toUpperCase() : '<i class="fa-solid fa-user"></i>';
                    initAppLogic();
                } else {
                    els.app.classList.add('hidden');
                    els.nav.classList.add('hidden');
                    els.auth.classList.remove('hidden');
                }
            }, 3000);
        });

        document.getElementById('auth-switch-btn').addEventListener('click', (e) => {
            e.preventDefault();
            isLoginMode = !isLoginMode;
            document.getElementById('auth-title').innerText = isLoginMode ? 'Welcome Back' : 'Create Account';
            document.getElementById('auth-submit-btn').innerText = isLoginMode ? 'Access System' : 'Initialize Account';
            document.getElementById('auth-switch-text').innerText = isLoginMode ? "Don't have an account?" : "Already verified?";
            e.target.innerText = isLoginMode ? 'Register' : 'Login';
            document.getElementById('auth-error').classList.add('hidden');
        });

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const errorEl = document.getElementById('auth-error');
            const btn = document.getElementById('auth-submit-btn');

            errorEl.classList.add('hidden');
            btn.disabled = true;
            btn.innerText = 'Processing...';

            try {
                if (isLoginMode) {
                    await auth.signInWithEmailAndPassword(email, password);
                } else {
                    await auth.createUserWithEmailAndPassword(email, password);
                }
            } catch (err) {
                errorEl.innerText = sanitizeInput(err.message);
                errorEl.classList.remove('hidden');
                btn.disabled = false;
                btn.innerText = isLoginMode ? 'Access System' : 'Initialize Account';
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());

        // --- 7. APP LOGIC (SOLVER, ETC) ---

        function initAppLogic() {
            // Render Team
            const teamContainer = document.getElementById('team-list');
            if(!teamContainer.innerHTML.trim()) {
                teamData.forEach(m => {
                    const div = document.createElement('div');
                    div.className = "glass-panel p-4 rounded-xl flex items-center gap-4 hover:border-teal-500/50 transition-colors";
                    div.innerHTML = `
                        <img src="${m.img}" class="w-12 h-12 rounded-full border border-teal-500/30 object-cover">
                        <div class="flex-1">
                            <h4 class="font-bold text-sm text-white">${m.name}</h4>
                            <div class="text-xs text-slate-400">Core Contributor</div>
                        </div>
                        <button class="like-btn px-3 py-1 rounded-full border border-slate-700 hover:text-pink-500" data-person="${m.id}">
                            <i class="fa-regular fa-heart"></i>
                        </button>
                    `;
                    teamContainer.appendChild(div);
                });
            }

            // Notice Board
            db.collection('settings').doc('notice').onSnapshot(doc => {
                if(doc.exists && doc.data().text) {
                    document.getElementById('notice-text').innerText = doc.data().text;
                    document.getElementById('notice-board').classList.remove('hidden');
                }
            });

            // Initialize Likes
            document.querySelectorAll('.like-btn').forEach(btn => {
                const pid = btn.dataset.person;
                // Real-time listener
                db.collection('likes').doc(pid).onSnapshot(doc => {
                    const count = doc.exists ? doc.data().count || 0 : 0;
                    const span = btn.querySelector('span') || btn;
                    if(span !== btn) span.innerText = count < 1000 ? count : (count/1000).toFixed(1)+'k';
                });
                
                // Toggle Logic
                btn.addEventListener('click', async () => {
                    if(!state.user) return;
                    const uid = state.user.uid;
                    const userLikeRef = db.collection('userLikes').doc(`${uid}_${pid}`);
                    const likeRef = db.collection('likes').doc(pid);

                    try {
                        await db.runTransaction(async (t) => {
                            const uDoc = await t.get(userLikeRef);
                            const lDoc = await t.get(likeRef);
                            const current = lDoc.exists ? lDoc.data().count || 0 : 0;

                            if(uDoc.exists) {
                                t.delete(userLikeRef);
                                t.update(likeRef, { count: Math.max(0, current - 1) });
                                btn.querySelector('i').classList.replace('fa-solid', 'fa-regular');
                            } else {
                                t.set(userLikeRef, { uid, pid });
                                t.set(likeRef, { count: current + 1 }, { merge: true });
                                btn.querySelector('i').classList.replace('fa-regular', 'fa-solid');
                            }
                        });
                    } catch(e) { console.error(e); }
                });
            });
        }

        // --- 8. SOLVER LOGIC ---

        // Subject Switching
        document.querySelectorAll('.subject-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.subject-btn').forEach(b => {
                    b.classList.remove('active', 'border-teal-500/50');
                    b.querySelector('.absolute').classList.remove('opacity-100');
                });
                btn.classList.add('active', 'border-teal-500/50');
                btn.querySelector('.absolute').classList.add('opacity-100');
                
                state.subject = btn.dataset.id;
                els.inputs.question.placeholder = `Type your ${subjects[state.subject].label} question here...`;
            });
        });

        // Image Upload
        document.getElementById('upload-btn').addEventListener('click', () => els.inputs.file.click());
        els.inputs.file.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    document.getElementById('image-preview').src = evt.target.result;
                    document.getElementById('image-preview-container').classList.remove('hidden');
                    state.imageData = {
                        inlineData: {
                            data: evt.target.result.split(',')[1],
                            mimeType: file.type
                        }
                    };
                };
                reader.readAsDataURL(file);
            }
        });
        document.getElementById('remove-image').addEventListener('click', () => {
            state.imageData = null;
            document.getElementById('file-input').value = '';
            document.getElementById('image-preview-container').classList.add('hidden');
        });

        // Solve Button
        document.getElementById('solve-btn').addEventListener('click', async () => {
            const q = els.inputs.question.value;
            if(!q && !state.imageData) return;

            const btn = document.getElementById('solve-btn');
            const resultContainer = document.getElementById('result-container');
            const resultContent = document.getElementById('result-content');

            // UI Loading State
            btn.innerHTML = '<div class="loader w-5 h-5 border-2"></div>';
            btn.disabled = true;
            resultContainer.classList.add('hidden');
            resultContent.innerHTML = '';

            try {
                const subjectInfo = subjects[state.subject];
                const detail = els.inputs.detail.value;
                
                const systemPrompt = `You are CreatorGpt, an AI tutor. 
                Context: ${subjectInfo.context}
                Detail Level: ${detail}.
                Provide a clear, secure, and helpful answer. Markdown supported.`;

                const model = "gemini-2.5-flash";
                
                let contentParts = [{ text: systemPrompt + "\n\nQuestion: " + q }];
                if(state.imageData) contentParts.unshift(state.imageData);

                const response = await ai.models.generateContent({
                    model: model,
                    contents: { parts: contentParts }
                });

                const text = response.text || "No response generated.";
                
                // Typewriter effect
                resultContainer.classList.remove('hidden');
                let i = 0;
                const speed = 10;
                
                // Sanitize and Simple Markdown Parse
                const safeText = sanitizeInput(text)
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-teal-300">$1</strong>')
                    .replace(/\n/g, '<br>');

                resultContent.innerHTML = safeText; // For simple render, actually typing HTML is hard, so we just fade in
                resultContent.classList.add('fade-enter');
                setTimeout(() => resultContent.classList.add('fade-enter-active'), 10);

            } catch (err) {
                console.error(err);
                resultContent.innerText = "Error: Could not connect to AI Neural Net. Please check your connection.";
                resultContainer.classList.remove('hidden');
            } finally {
                btn.innerHTML = '<i class="fa-solid fa-paper-plane"></i>';
                btn.disabled = false;
            }
        });

        // Helpers
        function sanitizeInput(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // Nav Logic
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => switchView(btn.dataset.target));
        });

        // Contact Form
        document.getElementById('contact-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;
            btn.innerText = 'Transmitting...';
            btn.disabled = true;
            
            try {
                await db.collection('contactMessages').add({
                    name: document.getElementById('contact-name').value,
                    email: document.getElementById('contact-email').value,
                    message: document.getElementById('contact-message').value,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Message Securely Transmitted.");
                e.target.reset();
            } catch(err) {
                alert("Transmission Failed.");
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        });

        // Speak & Copy
        document.getElementById('speak-btn').addEventListener('click', () => {
            const text = document.getElementById('result-content').innerText;
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = state.subject === 'bengali' ? 'bn-IN' : 'en-US';
            window.speechSynthesis.speak(u);
        });
        
        document.getElementById('copy-btn').addEventListener('click', () => {
            navigator.clipboard.writeText(document.getElementById('result-content').innerText);
            const icon = document.getElementById('copy-btn').querySelector('i');
            icon.className = 'fa-solid fa-check text-green-400';
            setTimeout(() => icon.className = 'fa-regular fa-copy', 2000);
        });

        // Initialize Effects
        initParticles();
        showSplashTextEffect();

    </script>
</body>
</html>